[server]
listen_addr = "0.0.0.0:51820"
public_ip = "{{ public_ip.content | default('0.0.0.0') }}"
cert_path = "/etc/oxidize/certs/server.crt"
key_path = "/etc/oxidize/certs/server.key"

[network]
interface = "{{ nic_config.DATA_NIC | default(nic_config.MGMT_NIC) | default('eth0') }}"
kernel_bypass = "{{ 'xdp' if nic_config.XDP_MODE | default('true') == 'true' else 'none' }}"
workers = {{ cpu_count.stdout | default('4') }}
zero_copy = {{ 'true' if nic_config.XDP_MODE | default('true') == 'true' else 'false' }}

[performance]
hugepages = {{ 'true' if (hugepages_count | default('0') | int) > 0 else 'false' }}
rx_ring_size = 4096
tx_ring_size = 4096
batch_size = 64

[quic]
max_idle_timeout_ms = 30000
initial_rtt_ms = 100
max_udp_payload_size = 1350
max_concurrent_streams = 100
max_connections = 10000

# QUIC Performance Tuning (+5-10% throughput)
initial_window = 14720          # 10 * MSS for faster ramp-up
max_window = 16777216           # 16MB max window
ack_delay_exponent = 3          # 8ms max ACK delay
max_ack_delay_ms = 25           # Balanced ACK timing
disable_active_migration = false # Allow connection migration
enable_0rtt = true              # 0-RTT resumption
max_0rtt_data = 16384           # 16KB early data

[logging]
level = "info"

# Multi-Region Relay Mesh (for scaling)
[mesh]
enabled = {{ mesh_enabled | default('false') }}
region = "{{ mesh_region | default('us-central') }}"
node_id = "{{ inventory_hostname | default('relay-1') }}"

# Peer relays (add as you scale)
# [[mesh.peers]]
# name = "relay-frankfurt"
# region = "eu-central"
# address = "frankfurt.oxd.sh:51820"
# 
# [[mesh.peers]]
# name = "relay-tokyo"
# region = "asia-pacific"
# address = "tokyo.oxd.sh:51820"

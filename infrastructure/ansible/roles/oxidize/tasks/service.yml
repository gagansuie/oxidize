---
- name: Remove old oxidize.service if exists
  file:
    path: /etc/systemd/system/oxidize.service
    state: absent
  become: yes
  register: old_service_removed

- name: Create systemd service
  template:
    src: oxidize.service.j2
    dest: /etc/systemd/system/oxidize-server.service
    mode: '0644'
  become: yes
  register: service_file

- name: Reload systemd
  systemd:
    daemon_reload: yes
  become: yes
  when: service_file.changed or old_service_removed.changed

- name: Enable oxidize-server service
  systemd:
    name: oxidize-server
    enabled: yes
  become: yes

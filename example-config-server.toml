# Oxidize Server Configuration Example
# Copy to /etc/oxidize/server.toml or ~/.config/oxidize/server.toml

# ============================================
# Network Configuration (Dual-Stack IPv4/IPv6)
# ============================================
# Server listens on [::]:51820 by default (dual-stack: accepts both IPv4 and IPv6)
# Pass --listen to override the bind address

# TCP fallback for restrictive networks (firewalls blocking UDP)
# Listens on port 51821 by default alongside UDP on 51820
# enable_tcp_fallback = true
# tcp_fallback_port = 51821

# Maximum number of concurrent connections
# Recommended: 10000 per 4GB RAM
max_connections = 10000

# Enable LZ4 compression for data packets
# Trades CPU for bandwidth (usually worth it)
enable_compression = true

# Only compress payloads larger than this (bytes)
# Smaller packets have too much overhead
compression_threshold = 512

# Buffer size for packet reading/writing (bytes)
# Larger = better throughput, more memory
# Must be >= MTU (typically 1500)
buffer_size = 65536

# Send keepalive pings every N seconds
# Prevents NAT timeout, detects dead connections
keepalive_interval = 30

# Close idle connections after N seconds
# Balance between resource usage and reconnect overhead
connection_timeout = 300

# Enable TCP acceleration (immediate ACK)
# Reduces perceived latency for TCP flows
enable_tcp_acceleration = true

# Enable content deduplication
# Saves bandwidth when multiple users download same data
enable_deduplication = true

# TLS Certificate Configuration
# Leave commented to use self-signed certificates (development only)
# For production, generate real certificates with Let's Encrypt
# tls_cert_path = "/etc/oxidize/cert.pem"
# tls_key_path = "/etc/oxidize/key.pem"

# Rate Limiting
# Maximum requests per IP address within the time window
rate_limit_per_ip = 100

# Rate limit time window in seconds
rate_limit_window_secs = 60

# Mobile Tunnel settings for mobile client compatibility
# Generate config with: ./oxidize-server --generate-mobile-config
enable_mobile_tunnel = false
# mobile_tunnel_port = 51820

# ROHC (Robust Header Compression) - RFC 3095
# Compresses IP/UDP/TCP headers for bandwidth savings
# Best for: Gaming, VoIP, high packet-rate workloads
# Requires librohc to be installed (see docs/ROHC.md)
enable_rohc = true

# Maximum packet size for ROHC compression (bytes)
rohc_max_size = 1500

# === 0-RTT Session Resumption ===
# Enable 0-RTT for faster client reconnects (saves ~1 RTT)
# Anti-replay protection is built-in via session state
enable_0rtt = true

# Maximum early data size in bytes for 0-RTT
# Maximum size: 4294967295 (u32::MAX)
max_early_data_size = 4294967295

# === AI/Heuristic Engine ===
# Enable AI-powered compression decisions using ML models
# When disabled, uses simple threshold-based compression
enable_ai_engine = true

# ============================================
# Authentication (REQUIRED for production)
# ============================================
# Generate keys with: oxidize-keygen --generate-all
# The app public key verifies that connections come from official Oxidize apps
# The API secret validates user API keys issued by your backend

# Enable authentication (reject unauthenticated connections)
# enable_auth = true

# Ed25519 public key for app signature verification (64 hex chars)
# This is the PUBLIC key - safe to store in config
# app_public_key = "YOUR_APP_PUBLIC_KEY_HEX_HERE"

# Secret for validating API key HMACs (64 hex chars)
# Keep this secret! Only on server, never in client apps
# api_secret = "YOUR_API_SECRET_HEX_HERE"

# Maximum timestamp age in seconds (replay protection)
# auth_timestamp_max_age = 300

# ============================================
# Performance Optimizations (Always Enabled)
# ============================================
# The following optimizations are always on:
# - Zero-copy buffer pooling (eliminates allocations)
# - Lock-free stream handling (no mutex on hot path)
# - ACK batching (8 per batch, reduces round-trips)
# - Latency instrumentation (Âµs-level timing)
